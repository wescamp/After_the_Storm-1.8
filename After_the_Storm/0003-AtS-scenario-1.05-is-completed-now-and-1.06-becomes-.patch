From 8367e21191357e7dd91c9fffc7a1452524d7a769 Mon Sep 17 00:00:00 2001
From: Ignacio R. Morelle <shadowm@wesnoth.org>
Date: Sun, 27 Dec 2009 11:10:41 -0300
Subject: [PATCH 3/4] AtS scenario 1.05 is completed now, and 1.06 becomes the new WIP final scenario

---
 _main.cfg                       |    2 +-
 changelog                       |    3 +
 scenarios/05_Bay_of_Tirigaz.cfg |  244 ++++++++++++++++++++++++++++++++++++--
 scenarios/06_Quenoth_Isle.cfg   |    8 +-
 4 files changed, 241 insertions(+), 16 deletions(-)

diff --git a/_main.cfg b/_main.cfg
index e52e49c..daa4939 100644
--- a/_main.cfg
+++ b/_main.cfg
@@ -38,7 +38,7 @@
     name= _ "After the Storm I: Fear"
     description=_"After the Emperor of Chaos was defeated, the races of the Great Continent hoped that his followers would give up the ongoing war. Meanwhile, Galas' band head back to the northern land to request aid in their next journey..."+"
 
-"+_"(Intermediate level, 4 scenarios of 12[?] completed.)"+"
+"+_"(Intermediate level, 5 scenarios of 12[?] completed.)"+"
 
 <span color='#888'>"+_"Version:"+"{~add-ons/After_the_Storm/dist/VERSION}"+"
 "+_"(requires Wesnoth 1.7.8 or later)"+"</span>"
diff --git a/changelog b/changelog
index 94fc008..cbb6a22 100644
--- a/changelog
+++ b/changelog
@@ -4,6 +4,9 @@ AFTER THE STORM - CHANGELOG
 
 Version 0.2.0+svn:
 ------------------
+* Scenarios:
+    * 1.05 - Bay of Tirigaz
+        * New scenario completed
 
 
 Version 0.2.0:
diff --git a/scenarios/05_Bay_of_Tirigaz.cfg b/scenarios/05_Bay_of_Tirigaz.cfg
index df0531c..2148af6 100644
--- a/scenarios/05_Bay_of_Tirigaz.cfg
+++ b/scenarios/05_Bay_of_Tirigaz.cfg
@@ -12,8 +12,6 @@
     {SCENARIO_MUSIC       "breaking_the_chains.ogg"}
     {EXTRA_SCENARIO_MUSIC "loyalists.ogg"}
 
-    {END_OF_PLAYABLE_SCENARIOS}
-
     {STORYTXT_BAY_OF_TIRIGAZ}
 
     {DAWN1}
@@ -40,7 +38,7 @@
         team_name=player
         user_team_name= _ "team_name^Galas"
 
-        {GOLD 300 280 260}
+        {GOLD 320 310 300}
 
         type=Elvish Wayfarer
         id=Galas
@@ -53,7 +51,7 @@
             {TRAIT_QUICK}
         [/modifications]
     [/side]
-#ifdef ATS_MAINTAINER_MODE
+
     [side]
         side=2
         team_name=player
@@ -75,6 +73,13 @@
             {TRAIT_STRONG}
         [/modifications]
 
+        {ai/aliases/stable_singleplayer.cfg}
+        [ai]
+            {AI_NO_SCOUTS}
+            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.80}
+            {AI_SIMPLE_ALWAYS_ASPECT caution    0.20}
+        [/ai]
+
         [unit]
             generate_name,random_traits=yes,yes
             ai_special=guardian
@@ -224,7 +229,7 @@
         team_name=lizards
         user_team_name= _ "Invaders"
 
-        {GOLD 290 360 420}
+        {GOLD 150 180 210}
         recruit="Saurian Skirmisher, Saurian Augur, Mudcrawler, Vampire Bat"
 
         id=Rishix
@@ -237,6 +242,14 @@
             {TRAIT_RESILIENT}
         [/modifications]
 
+        {ai/aliases/stable_singleplayer.cfg}
+        [ai]
+            {AI_SIMPLE_ALWAYS_ASPECT aggression           1.00}
+            {AI_SIMPLE_ALWAYS_ASPECT caution              0.00}
+            {AI_SIMPLE_ALWAYS_ASPECT attack_depth {DIFF 2 3 4}}
+            {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "scout,scout,healer,scout,archer,scout,archer"}
+        [/ai]
+
         [unit]
             generate_name,random_traits=yes,yes
             type=Saurian Ambusher
@@ -293,7 +306,8 @@
         team_name=lizards
         user_team_name= _ "Invaders"
 
-        {GOLD 290 360 420}
+        {GOLD 330 360 390}
+        {INCOME 2 4 5}
         recruit="Saurian Skirmisher, Saurian Augur, Mudcrawler, Vampire Bat"
 
         id=Ishkaal
@@ -305,13 +319,108 @@
             {TRAIT_RESILIENT}
             {TRAIT_INTELLIGENT}
         [/modifications]
+
+        {ai/aliases/stable_singleplayer.cfg}
+        [ai]
+            {AI_SIMPLE_ALWAYS_ASPECT aggression           1.00}
+            {AI_SIMPLE_ALWAYS_ASPECT caution              0.00}
+            {AI_SIMPLE_ALWAYS_ASPECT attack_depth {DIFF 3 4 4}}
+            {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "scout,scout,healer,scout,archer,scout,archer,scout,healer"}
+        [/ai]
+
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=13,33
+            upkeep=free
+        [/unit]
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=12,30
+            upkeep=free
+        [/unit]
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=9,30
+            upkeep=free
+        [/unit]
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=3,33
+            upkeep=free
+        [/unit]
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=6,35
+            upkeep=free
+        [/unit]
+#ifndef EASY
+        [unit]
+            generate_name,random_traits=yes,yes
+            ai_special=guardian
+            type=Saurian Flanker
+            x,y=12,35
+            upkeep=free
+        [/unit]
+#endif
     [/side]
 
     [side]
         side=5
         team_name=lizards
         user_team_name= _ "Sea creatures"
+        hidden=yes
         no_leader=yes
+
+        {ai/aliases/stable_singleplayer.cfg}
+        [ai]
+            [goal]
+                [criteria]
+                    x=16-28
+                    y=13-40
+                [/criteria]
+                value=10.0
+            [/goal]
+            {AI_SIMPLE_ALWAYS_ASPECT aggression 200.00}
+            {AI_SIMPLE_ALWAYS_ASPECT caution      0.00}
+            {AI_SIMPLE_ALWAYS_ASPECT grouping       no}
+        [/ai]
+    [/side]
+
+    [side]
+        side=6
+        team_name=lizards
+        user_team_name= _ "Water serpents"
+        hidden=yes
+        no_leader=yes
+
+        {ai/aliases/stable_singleplayer.cfg}
+        [ai]
+            [goal]
+                [criteria]
+                    side=1
+                [/criteria]
+                value=9.9
+            [/goal]
+            [goal]
+                [criteria]
+                    side=2
+                [/criteria]
+                value=0.1
+            [/goal]
+            {AI_SIMPLE_ALWAYS_ASPECT aggression 200.00}
+            {AI_SIMPLE_ALWAYS_ASPECT caution      0.00}
+            {AI_SIMPLE_ALWAYS_ASPECT grouping       no}
+        [/ai]
     [/side]
 
     {STARTING_VILLAGES 2 40}
@@ -417,6 +526,7 @@ NE: Arthol"
 
     [event]
         name=prestart
+        {VARIABLE undead_attacks 0}
 
         {OBJECTIVES (
             {OBJECTIVE_VICTORY ( _ "Defeat both enemy leaders")}
@@ -642,12 +752,12 @@ NE: Arthol"
 
         [message]
             speaker=Galas
-            message= _ "That city to the northwest... is it the port of Tirigaz?"
+            message= _ "That city to the northwest...is it the port of Tirigaz?"
         [/message]
 
         [message]
             speaker=Elynia
-            message= _ "Yes... although it wasn't so well fortified during my times. Things have changed here indeed."
+            message= _ "Yes...although it wasn't so well fortified during my times. Things have changed here indeed."
         [/message]
 
         [message]
@@ -666,6 +776,7 @@ NE: Arthol"
             type=Orcish Crossbowman
             id=Vuruk
             name= _ "Vuruk"
+            {IS_HERO}
             x,y=35,29
             side=1
             facing=ne
@@ -784,6 +895,12 @@ NE: Arthol"
 
         [redraw][/redraw]
 
+        [scroll_to]
+            x,y=2,16
+        [/scroll_to]
+
+        [redraw][/redraw]
+
         [delay]
             time=250
         [/delay]
@@ -794,6 +911,101 @@ NE: Arthol"
         [/message]
     [/event]
 
+    [event]
+        name=attack
+        first_time_only=no
+        [filter]
+            race=undead
+            side=1
+        [/filter]
+
+        {VARIABLE_INC undead_attacks}
+
+        [fire_event]
+            name=remark on undead
+        [/fire_event]
+    [/event]
+
+    [event]
+        name=attack
+        first_time_only=no
+        [filter_second]
+            race=undead
+            side=1
+        [/filter_second]
+
+        {VARIABLE_INC undead_attacks}
+
+        [fire_event]
+            name=remark on undead
+        [/fire_event]
+    [/event]
+
+    [event]
+        name=remark on undead
+        first_time_only=no
+        [if]
+            {VARIABLE_NUM_EQUALS undead_attacks 6}
+            [then]
+                [message]
+                    side=3
+                    [or]
+                        side=4
+                    [/or]
+                    message= _ "Where did all these damned spawns come from?"
+                [/message]
+            [/then]
+        [/if]
+    [/event]
+
+    [event]
+        name=turn 6
+        [message]
+            speaker=Ishkaal
+            message= _ "This is becoming harder than it was supposed to be."
+        [/message]
+
+        [set_variables]
+            mode=replace
+            name=serpent_locs
+            [literal]
+                x,y,facing=23,36,nw
+            [/literal]
+            [literal]
+                x,y,facing=13,30,ne
+            [/literal]
+#ifndef EASY
+            [literal]
+                x,y,facing=18,34,n
+            [/literal]
+            [literal]
+                x,y,facing=10,24,se
+            [/literal]
+#endif
+        [/set_variables]
+
+        {FOREACH serpent_locs i}
+            [unit]
+                generate_name,random_traits=yes,yes
+                x=$serpent_locs[$i].x
+                y=$serpent_locs[$i].y
+                facing=$serpent_locs[$i].facing
+                type=Water Serpent
+                side=6
+            [/unit]
+        {NEXT i}
+
+        {FOREACH serpent_locs i}
+            [scroll_to]
+                x=$serpent_locs[$i].x
+                y=$serpent_locs[$i].y
+            [/scroll_to]
+            [redraw][/redraw]
+        {NEXT i}
+
+        {CLEAR_VARIABLE serpent_locs}
+    [/event]
+
     #
     # Defeat condition: village tiles in the Arthol/Tirigaz areas get captured by saurians
     #
@@ -1003,10 +1215,14 @@ NE: Arthol"
     [event]
         name=moveto
         [filter]
-            side=3
-            [or]
-                side=4
-            [/or]
+            x=1-40
+            y=1-13
+            [and]
+                side=3
+                [or]
+                    side=4
+                [/or]
+            [/and]
         [/filter]
 
         [message]
@@ -1109,6 +1325,8 @@ NE: Arthol"
             speaker=Tan-Vatar
             message= _ "The Grand Council? Why didn't you mention it in the first place? We'll do anything we can to help you in your mission. It'll be difficult to gather a crew for you, but at least I can give you one of our fastest transport vessels."
         [/message]
+
+        {CLEAR_VARIABLE undead_attacks,vuruk_store}
     [/event]
-#endif
+
 [/scenario]
diff --git a/scenarios/06_Quenoth_Isle.cfg b/scenarios/06_Quenoth_Isle.cfg
index 61b7b5b..30cd9f3 100644
--- a/scenarios/06_Quenoth_Isle.cfg
+++ b/scenarios/06_Quenoth_Isle.cfg
@@ -12,7 +12,11 @@
     {SCENARIO_MUSIC       "elvish-theme.ogg"}
     {EXTRA_SCENARIO_MUSIC "heroes_rite.ogg"}
 
+    {END_OF_PLAYABLE_SCENARIOS}
+
+#ifdef ATS_MAINTAINER_MODE
     {STORYTXT_QUENOTH_ISLE}
+#endif
 
     {DAWN1}
     {MORNING1}
@@ -52,6 +56,7 @@
         [/modifications]
     [/side]
 
+#ifdef ATS_MAINTAINER_MODE
     [event]
         name=prestart
 
@@ -75,8 +80,6 @@
         )}
     [/event]
 
-    {UNDER_CONSTRUCTION}
-
     [event]
         name=start
         [endlevel]
@@ -84,4 +87,5 @@
             end_text= _ "To be continued..."
         [/endlevel]
     [/event]
+#endif
 [/scenario]
-- 
1.6.5

